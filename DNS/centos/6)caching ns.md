**Caching Nameserver**
	
	A caching nameserver stores DNS query results temporarily to improve performance and reduce the load on authoritative nameservers. This guide covers the setup and configuration of a caching nameserver using BIND (Berkeley Internet Name Domain).

---

**Check Hostname**

**Display Current Hostname**

```

hostname

```

**Update Hostname**

1. Open the hostname configuration file:

Â Â  ```

Â Â  vim /etc/hostname

Â Â  ```

Â  ```

Â  ns1.armour.local

Â Â  ```

2. Modify the hostname value as needed.

3. Save and exit.

**Reboot the System**

```

reboot

```

**Confirm the Hostname Change**

```

hostname

```

**Check DNS Resolver Configuration**

**View resolv.conf for DNS Settings**

```

cat /etc/resolv.conf

```

```

nameserver 8.8.8.8

nameserver 8.8.4.4

```

---

**Install and Configure BIND**

**Check if BIND is Installed**

```

rpm -qa | grep bind

```

**Install BIND and Utilities**

```

yum install bind

```

```

yum install bind*

```

**Verify Installation**

```

rpm -qa | grep bind

```

**Get Information About the Installed Package**

```

rpm -qi bind

```

**List Installed Files**

```

rpm -ql bind

```

**List Configuration Files**

```

rpm -qc bind

```

**Key Configuration Files**

- `/etc/named.conf`

- `/etc/named.iscdlv.key`

- `/etc/named.rfc1912.zones`

- `/etc/named.root.key`

- `/var/named`

Â  - `/var/named/data/`

Â  - `/var/named/dynamic/`

Â  - `/var/named/named.ca`

Â  - `/var/named/named.empty`

Â  - `/var/named/named.localhost`

Â  - `/var/named/named.loopback`

Â  - `/var/named/slaves/`

**1. /etc/named.conf**

- This is the main configuration file for BIND.

- It defines the server options, zones, logging settings, access control lists (ACLs), and security policies.

- Example configurations:

Â  - Which IP addresses and ports to listen on.

Â  - Allowed clients for DNS queries.

Â  - Path to zone files.

**2. /etc/named.iscdlv.key**

- Contains a TSIG (Transaction Signature) key used for secure communication between DNS servers.

- Primarily used for:

Â  - DNS dynamic updates.

Â  - Zone transfers between servers.

- This file is often autogenerated and managed by BIND itself.

**3. /etc/named.rfc1912.zones**

- Contains the configuration for default zones as defined by RFC 1912.

- Defines common zones like:

Â  - localhost

Â  - 0.0.127.in-addr.arpa (for loopback address reverse lookups)

Â  - 255.in-addr.arpa (for broadcast address reverse lookups)

- Helps resolve local network issues and reverse DNS lookups.

**4. /etc/named.root.key**

- Holds the root trust anchor key for DNSSEC (DNS Security Extensions).

- Used to validate responses from the root DNS servers.

- If this key is missing or outdated, DNSSEC validation will fail.

**5. /var/named**

- This is the working directory for BIND, where zone files and cache data are stored.

**5a. /var/named/data**

- Contains BIND-generated data files like:

Â  - `cache_dump.db` â€“ Stores cached DNS records.

Â  - `named_stats.txt` â€“ Stores statistics.

Â  - `named.recursing` â€“ Logs recursive queries.

Â  - `named.secroots` â€“ Logs secure root data.

**5b. /var/named/dynamic**

- Stores dynamically generated zone files for DNS updates.

- Used when you configure dynamic DNS or allow clients to update DNS records.

**5c. /var/named/named.ca**

- Contains the list of root DNS servers.

- Essential for resolving queries starting from the root.

- Loaded into memory when BIND starts to seed the root server list.

**5d. /var/named/named.empty**

- Used to define an empty zone for queries to unresponsive or non-existent zones.

- Prevents unnecessary traffic to root servers for invalid domains.

**5e. /var/named/named.localhost**

- Defines the zone for localhost (127.0.0.1).

- Ensures that the local machine can always resolve its own name.

**5f. /var/named/named.loopback**

- Used for reverse lookup of 127.0.0.1.

- Ensures that the loopback address can be resolved.

**5g. /var/named/slaves**

- Directory for storing zone files transferred from master DNS servers (if the server is configured as a slave).

- Used in secondary DNS setups for redundancy and load balancing.

**View Cache File**

```

cat /var/named/named.ca

```

**Manage BIND Service**

**Check Service Status**

```

systemctl status named.service

```

**Start the Service**

```

systemctl start named.service

```

**Check Open Ports for Named**

```

netstat -nltup | grep named

```

```

netstat -nltup | grep 53

```

**Test Using dig**

**Test Localhost Resolution**

```

dig google.com @127.0.0.1

```

**Configure Network Settings**

**CentOS 7 â€“ Modify Network Interface Configuration**

Open the network interface configuration file:

```

vim /etc/sysconfig/network-scripts/ifcfg-enp0s3

```

**Example:**

```

TYPE=Ethernet

BOOTPROTO=static

DEFROUTE=yes

IPV4_FAILURE_FATAL=no

IPV6INIT=no

IPV6_AUTOCONF=yes

IPV6_DEFROUTE=yes

IPV6_PEERDNS=yes

IPV6_PEERROUTES=yes

IPV6_FAILURE_FATAL=no

IPV6_ADDR_GEN_MODE=stable-privacy

NAME=enp0s3

UUID=92a9be99-ddba-4e75-a601-a385f8dcb88f

DEVICE=enp0s3

ONBOOT=yes

IPADDR=192.168.1.37

PREFIX=24

GATEWAY=192.168.1.1

DNS1=127.0.0.1

PROXY_METHOD=none

BROWSER_ONLY=no

```

**Configure BIND (named.conf)**

**Example named.conf File**

```

vim /etc/named.conf

```

```

options {

Â Â Â  listen-on port 53 { 127.0.0.1; 192.168.1.50; };

Â Â Â  listen-on-v6 port 53 { ::1; };

Â Â Â  directoryÂ Â Â Â Â Â  "/var/named";

Â Â Â  dump-fileÂ Â Â Â Â Â  "/var/named/data/cache_dump.db";

Â Â Â  statistics-file "/var/named/data/named_stats.txt";

Â Â Â  memstatistics-file "/var/named/data/named_mem_stats.txt";

Â Â Â  recursing-fileÂ  "/var/named/data/named.recursing";

Â Â Â  secroots-fileÂ Â  "/var/named/data/named.secroots";

Â Â Â  allow-queryÂ Â Â Â  { localhost; 192.168.1.0/24; };

Â Â Â  recursion yes;

Â Â Â  dnssec-enable yes;

Â Â Â  dnssec-validation yes;

Â Â Â  bindkeys-file "/etc/named.root.key";

Â Â Â  managed-keys-directory "/var/named/dynamic";

Â Â Â  pid-file "/run/named/named.pid";

Â Â Â  session-keyfile "/run/named/session.key";

};

logging {

Â Â Â  channel default_debug {

Â Â Â Â Â Â Â  file "data/named.run";

Â Â Â Â Â Â Â  severity dynamic;

Â Â Â  };

};

zone "." IN {

Â Â Â  type hint;

Â Â Â  file "named.ca";

};

include "/etc/named.rfc1912.zones";

include "/etc/named.root.key";

```

**Configure Firewall Rules (Firewalld)**

Allow DNS Traffic (TCP and UDP Port 53):

```

firewall-cmd --permanent --add-port=53/tcp

```

```

firewall-cmd --permanent --add-port=53/udp

```

```

firewall-cmd --reload

```

This will permanently open both TCP and UDP port 53 for DNS queries. ðŸš€

---

**Configure Firewall Rules (UFW)**

Allow DNS Traffic (TCP and UDP Port 53):

```

ufw allow 53/tcp

```

```

ufw allow 53/udp

```

This will open both TCP and UDP port 53 for DNS queries. ðŸ˜Ž

**Define ACL in named.conf**

```

vim /etc/named.conf

```

**Example:**

```plaintext

acl ns_ip_add {

Â Â Â  127.0.0.1;

Â Â Â  192.168.1.34;

Â Â Â  192.168.1.35;

Â Â Â  192.168.1.36;

Â Â Â  192.168.1.37;

};

acl mynetwork {

Â Â Â  127.0.0.1;

Â Â Â  192.168.1.0/24;

};

options {

Â Â Â  listen-on port 53 { ns_ip_add; };

Â Â Â  listen-on-v6 port 53 { ::1; };

Â Â Â  directoryÂ Â Â Â Â Â  "/var/named";

Â Â Â  dump-fileÂ Â Â Â Â Â  "/var/named/data/cache_dump.db";

Â Â Â  statistics-file "/var/named/data/named_stats.txt";

Â Â Â  memstatistics-file "/var/named/data/named_mem_stats.txt";

Â Â Â  recursing-fileÂ  "/var/named/data/named.recursing";

Â Â Â  secroots-fileÂ Â  "/var/named/data/named.secroots";

Â Â Â  allow-queryÂ Â Â Â  { mynetwork; };

Â Â Â  recursion yes;

Â Â Â  dnssec-enable yes;

Â Â Â  dnssec-validation yes;

Â Â Â  bindkeys-file "/etc/named.root.key";

Â Â Â  managed-keys-directory "/var/named/dynamic";

Â Â Â  pid-file "/run/named/named.pid";

Â Â Â  session-keyfile "/run/named/session.key";

};

logging {

Â Â Â  channel default_debug {

Â Â Â Â Â Â Â  file "data/named.run";

Â Â Â Â Â Â Â  severity dynamic;

Â Â Â  };

};

zone "." IN {

Â Â Â  type hint;

Â Â Â  file "named.ca";

};

include "/etc/named.rfc1912.zones";

include "/etc/named.root.key";

```

**Restart Services**

**Restart BIND Service**

```

systemctl restart named.service

```

**Restart Firewall**

```

systemctl restart firewalld.service

```

---

**Test Setup**

**Use dig to Test DNS Resolution**

```

dig google.com @192.168.1.50

```

---

Now set dns ip in client as of the server and test resolving names by nslookup of visiting sites etc